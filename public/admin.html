<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理網頁</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
    h2 { 
        color: #0d6efd; 
        border-left: 5px solid #0d6efd; 
        padding-left: 15px; 
        margin-bottom: 20px; }
    body { 
        background-color: #121212; 
        color: #e0e0e0; 
        padding-top: 50px; }
    .square { 
        padding: 25px; 
        border-radius: 12px; 
        margin-bottom: 30px; 
        border: 1.5px solid #ff0000; }
    .preview-img { 
        max-width: 200px; 
        border-radius: 8px; 
        margin-top: 15px; 
        display: none; }
    
</style>
<body>
<div class="container">
    <h2 class="text-center mb-4">作品後台管理</h2>

    <div class="admin-card mb-4">
        <h4>1. 新增作品</h4>
        <form action="/addPortfolio" method="POST" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label>作品類型</label>
                    <select class="form-select" name="category" required>
                        <option value="drawing">DRAWING</option>
                        <option value="picture">PICTURE</option>
                        <option value="video">VIDEO</option>
                        <option value="model">MODEL</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label>作品名稱</label>
                    <input type="text" class="form-control" name="title" required>
                </div>
                <div class="col-md-3 mb-3">
                    <label>新增人員</label>
                    <input type="text" class="form-control" name="author" required>
                </div>
                <div class="col-md-3 mb-3">
                    <label>作品檔案</label>
                    <input type="file" class="form-control" name="workFile" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary w-100">確認上傳</button>
        </form>
    </div>

<div class="admin-card">
    <h4>2. 查找作品</h4>
    <div class="row g-2">
        <div class="col-md-5">
            <select id="searchType" class="form-select" onchange="updateTitleList('searchType', 'searchTitleSelect')">
                <option value="" disabled selected>選擇作品類型</option>
                <option value="drawing">DRAWING</option>
                <option value="picture">PICTURE</option>
                <option value="video">VIDEO</option>
                <option value="model">MODEL</option>
            </select>
        </div>
        <div class="col-md-5">
            <select id="searchTitleSelect" class="form-select">
                <option value="">請先選擇類型</option>
            </select>
        </div>
        <div class="col-md-2">
            <button onclick="doSearch()" class="btn btn-info w-100">搜尋</button>
        </div>
    </div>
    <div class="preview-box text-center">
        <p id="searchMsg" class="mt-2"></p>
        <img id="searchImg" src="" alt="預覽" style="max-width:300px; display:none; margin:0 auto;">
    </div>
</div>

<div class="admin-card square">
    <h4 class="text-danger">3. 刪除作品</h4>
    <form action="/deletePortfolio" method="POST">
        <div class="row">
            <div class="col-md-4 mb-3">
                <label>作品類型</label>
                <select class="form-select" name="category" id="deleteType" onchange="updateTitleList('deleteType', 'deleteTitleSelect')" required>
                    <option value="" disabled selected>選擇類型</option>
                    <option value="drawing">DRAWING</option>
                    <option value="picture">PICTURE</option>
                    <option value="video">VIDEO</option>
                    <option value="model">MODEL</option>
                </select>
            </div>
            <div class="col-md-4 mb-3">
                <label>選擇作品名稱</label>
                <select class="form-select" name="title" id="deleteTitleSelect" required>
                    <option value="">請先選擇類型</option>
                </select>
            </div>
            <div class="col-md-4 mb-3">
                <label>輸入作品名確認刪除</label>
                <input type="text" class="form-control border-danger" name="confirmCode" placeholder="需與作品名稱一致" required>
            </div>
        </div>
        <button type="submit" class="btn btn-danger w-100">確認刪除</button>
    </form>
</div>

<script>
    // 自動更新名稱選單的函數
    function updateTitleList(typeId, selectId) {
        const category = document.getElementById(typeId).value;
        const targetSelect = document.getElementById(selectId);
        
        fetch(`/getPortfolioNames?category=${category}`)
            .then(res => res.json())
            .then(data => {
                targetSelect.innerHTML = '<option value="">請選擇作品</option>';
                data.forEach(item => {
                    let opt = document.createElement('option');
                    opt.value = item.title;
                    opt.innerText = item.title;
                    targetSelect.appendChild(opt);
                });
            });
    }

    // 搜尋功能
    function doSearch() {
        const cat = document.getElementById('searchType').value;
        const title = document.getElementById('searchTitleSelect').value;
        if(!title) return alert("請先選擇作品");

        fetch(`/portfolioSearch?category=${cat}&title=${title}`)
            .then(res => res.json())
            .then(data => {
                const img = document.getElementById('searchImg');
                const msg = document.getElementById('searchMsg');
                if(data) {
                    msg.innerText = "找到作品：" + data.title + " (作者：" + data.author + ")";
                    img.src = data.filePath;
                    img.style.display = 'block';
                }
            });
    }
</script>
</body>
</html>